#! /bin/bash

# --------------------------------------------
# Created by Statemood, 2018.03.08
#            I.am.RuLin@gmail.com
#
# Project dockerfiles:
#    https://github.com/Statemood/dockerfiles
# --------------------------------------------

# Automatic build docker images

u=""
p=""

# Build root dir
 br="/data/build/dockerfiles"
lib="$br/Dockerfiles/library"

cd $(dirname $br)
# Remove exist files
test -d "$br" && rm -rf $br

# Download dockerfiles from github
git clone https://github.com/Statemood/dockerfiles.git

docker login -u $u -p $p

cd $lib
for name in *
do
    for t in $name/*
    do
        tag="$(basename $t)"
        if [ -f "$t/Dockerfile" ]
        then
            image="statemood/$name:$tag"
            echo "Build image $image"
            echo docker build -t $image $t

            echo "Push image $image"
            docker push $image

        else
            echo "Error: No Dockerfile found in dir: $t"
        fi
    done
done
